{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "use-virtualize",
  "type": "registry:hook",
  "title": "Use Virtualize",
  "description": "A hook to virtualize a list of items",
  "dependencies": [
    "@tanstack/react-query",
    "@tanstack/react-virtual"
  ],
  "registryDependencies": [],
  "files": [
    {
      "path": "registry/hooks/use-virtualize.tsx",
      "content": "import React, { useEffect } from 'react';\nimport { type QueryFunction, useInfiniteQuery } from '@tanstack/react-query';\nimport { useVirtualizer } from '@tanstack/react-virtual';\n\ninterface Object {\n  id: string;\n}\n\ninterface CursorPagination<Response extends Object> {\n  nextCursor?: string;\n  data: Array<Response>;\n}\n\ninterface UseVirtualizeProps<O extends Object, C extends CursorPagination<O>> {\n  queryKey: string;\n  queryFn: QueryFunction<C, Array<string>, string>;\n}\n/**\n * A hook to virtualize a list of items using the infinite query hook and the virtualizer.\n *\n * @example\n * ```tsx\n * const fetchThreads = useThreadsHook();\n  const { parentRef, rowVirtualizer, status, hasNextPage, allRows } =\n    useVirtualize({\n      queryKey: 'threads',\n      queryFn: async () =>\n        fetchThreads(projectId, {\n          take: 10,\n          order: 'desc',\n        }),\n    });\n\n     {status === 'pending' ? (\n          <div className='flex flex-col items-center justify-center gap-2'>\n            <Spinner />\n            <span className='text-xs'>Loading</span>\n          </div>\n        ) : status === 'error' ? (\n          <span className='text-destructive text-xs'>\n            Error loading\n          </span>\n        ) : (\n          <div\n            ref={parentRef}\n            className='max-w-full'\n            style={{\n              height: `60vh`,\n              width: `100%`,\n              overflow: 'auto',\n            }}>\n            <div\n              style={{\n                height: `${rowVirtualizer.getTotalSize()}px`,\n                width: '100%',\n                position: 'relative',\n              }}>\n              {rowVirtualizer.getVirtualItems().map((virtualRow) => {\n                const isLoaderRow = virtualRow.index > allRows.length - 1;\n                const row = allRows[virtualRow.index];\n\n                return (\n                  <div\n                    key={virtualRow.index}\n                    style={{\n                      position: 'absolute',\n                      top: 0,\n                      left: 0,\n                      width: '100%',\n                      height: `${virtualRow.size}px`,\n                      transform: `translateY(${virtualRow.start}px)`,\n                    }}>\n                    {isLoaderRow ? (\n                      hasNextPage ? (\n                        <span className='text-xs text-muted-foreground'>\n                          {t('threads.sidebar.loading')}\n                        </span>\n                      ) : (\n                        <span className='text-xs text-muted-foreground'>\n                          {t('threads.sidebar.noMoreToLoad')}\n                        </span>\n                      )\n                    ) : (\n                      row && <Button variant={'ghost'}>{row.title}</Button>\n                    )}\n                  </div>\n                );\n              })}\n * ```\n * @param queryKey - The query key to use for the infinite query.\n * @param queryFn - The query function to use for the infinite query.\n * @returns\n */\nexport function useVirtualize<O extends Object, C extends CursorPagination<O>>({\n  queryKey,\n  queryFn,\n}: UseVirtualizeProps<O, C>) {\n  const { status, data, isFetchingNextPage, fetchNextPage, hasNextPage } =\n    useInfiniteQuery({\n      queryKey: [queryKey],\n      queryFn,\n      getNextPageParam: (lastGroup) => lastGroup.nextCursor,\n      initialPageParam: '',\n    });\n\n  const allRows = data ? data.pages.flatMap((page) => page.data) : [];\n  const parentRef = React.useRef<HTMLDivElement>(null);\n\n  const rowVirtualizer = useVirtualizer({\n    count: hasNextPage ? allRows.length + 1 : allRows.length,\n    getScrollElement: () => parentRef.current,\n    estimateSize: () => 40,\n    getItemKey: (index) => allRows[index]?.id ?? index,\n    gap: 5,\n  });\n\n  const virtualItems = rowVirtualizer.getVirtualItems();\n\n  useEffect(() => {\n    const lastItem = virtualItems.at(-1);\n\n    if (!lastItem) {\n      return;\n    }\n\n    if (\n      lastItem.index >= allRows.length - 1 &&\n      hasNextPage &&\n      !isFetchingNextPage\n    ) {\n      // fetch next 'page' when the end is reached and there are more pages to load\n      // eslint-disable-next-line @typescript-eslint/no-floating-promises\n      fetchNextPage();\n    }\n  }, [\n    hasNextPage,\n    fetchNextPage,\n    allRows.length,\n    isFetchingNextPage,\n    virtualItems,\n  ]);\n\n  return {\n    status,\n    parentRef,\n    rowVirtualizer,\n    hasNextPage,\n    allRows,\n  };\n}\n",
      "type": "registry:hook"
    }
  ],
  "categories": [
    "hooks"
  ]
}